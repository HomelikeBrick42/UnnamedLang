proc get_file_handle(id: u32) => ^void #extern "__acrt_iob_func"
let stdin = get_file_handle(0)
let stdout = get_file_handle(1)
let stderr = get_file_handle(2)

proc factorial(n: u64) => u64 {
    if n <= 1 {
        return 1
    } else {
        return n * factorial(n - 1)
    }
}

proc print_u64(value: u64, handle: ^void) => void {
    var length <- 0
    {
        var copy <- value
        if copy == 0 {
            length <- 1
        } else {
            while copy > 0 {
                copy <- copy / 10
                length <- length + 1
            }
        }
    }

    var i <- length - 1
    while i >= 0 {
        var copy <- value
        var j <- 0
        while j < i {
            copy <- copy / 10
            j <- j + 1
        }
        let digit = copy % 10 + 48
        print_char(cast(s32) digit, handle)
        i <- i - 1
    }
}

print_u64(factorial(6), stdout)
print_char(10, stdout)

proc change_value(ptr: ^u64, value: u64) => void {
    ptr^ <- value * 25
}

var foo: u64 <- 5
print_u64(foo, stdout)
print_char(10, stdout)

change_value(&foo, 10)
print_u64(foo, stdout)
print_char(10, stdout)

proc print_char(value: s32, handle: ^void) => s32 #extern "fputc"
proc input_char(handle: ^void) => s32 #extern "fgetc"
